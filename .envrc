#!/bin/bash
# .envrc - Environment setup for optical flow FPGA project

# Use direnv's built-in Python layout (handles venv creation/activation automatically)
layout python python3.12

# Uncomment and adjust path to your Vivado installation (dev only, not for building and sim):
# export VIVADO_PATH="/tools/Xilinx/Vivado/2022.2"
# export PATH="$VIVADO_PATH/bin:$PATH"

# Add python directory to PYTHONPATH for local imports
export PYTHONPATH="${PWD}/python:${PYTHONPATH}"

# Add Verible tools to PATH (after running setup_verible.sh)
if [ -d ".tools/verible/bin" ]; then
    PATH_add ".tools/verible/bin"
fi

# Helper aliases
alias pytest='python -m pytest'
alias synth-unopt='./scripts/build.sh unopt'
alias synth-opt='./scripts/build.sh opt'

# Print status on activation
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "Optical Flow FPGA Environment"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "  Python:  $(python --version) @ $(which python)"
echo "  Pip:     $(pip --version | cut -d' ' -f1-2)"
if command -v vivado &> /dev/null; then
    echo "  Vivado:  $(vivado -version 2>&1 | head -1 | cut -d' ' -f2)"
else
    echo "  Vivado: Not found (add to .envrc if needed)"
fi
if command -v verible-verilog-lint &> /dev/null; then
    echo "  Verible: $(verible-verilog-lint --version 2>&1 | head -1)"
else
    echo "  Verible: Not installed (run ./scripts/setup_verible.sh)"
fi
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
